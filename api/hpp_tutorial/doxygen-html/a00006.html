<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Implementing a new path planning algorithm</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head><body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Implementing a new path planning algorithm </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The code of this tutorial can be found in</p>
<div class="fragment"><div class="line">src/tutorial.cc.</div>
</div><!-- fragment --><p> The compilation and installation instructions can be found in </p>
<div class="fragment"><div class="line">CMakeLists.txt</div>
</div><!-- fragment --><p>.</p>
<h1><a class="anchor" id="hpp_tutorial_tutorial_2_class_planner"></a>
Implementation of class Planner</h1>
<p>File <code>src/tutorial.cc</code> implements class hpp::tutorial::Planner, deriving from abstract class <a class="elRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00059.html">hpp::core::PathPlanner</a>. In this section, we explain some specific parts of the code.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00166.html#gab13c9e4772035258ef0d4d83d36b1a8e">HPP_PREDEF_CLASS</a> (Planner);</div>
</div><!-- fragment --><p> is a macro containing the forward declaration of class <code>Planner</code> as well as <code>PlannerWkPtr_t</code> for weak pointer to class <code>Planner</code>. See </p>
<div class="fragment"><div class="line">hpp/util/pointer.hh</div>
</div><!-- fragment --><p> for details.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> PlannerPtr_t <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00164.html#ga3395c68307cad504abcf8cac8ea725fa">create</a> (<span class="keyword">const</span> core::Problem&amp; <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00164.html#ga9d07d63edbc71df565164e70cb807057">problem</a>, <span class="keyword">const</span> core::RoadmapPtr_t&amp; roadmap)</div>
</div><!-- fragment --><p> As most classes, <a class="elRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00059.html">hpp::core::PathPlanner</a> and any derived class are manipulated via shared pointers. Users are not allowed to define variables of the type. Instead, they are required to call method <code>create</code> and to store the resulting shared pointer. For this reason, the constructors are all protected. </p>
<dl class="section note"><dt>Note</dt><dd>method <code>create</code> calls protected method <code>init</code> that is explained later on.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> oneStep ()</div>
</div><!-- fragment --><p> This method runs one step of our the algorithm. The new algorithm is a basic version of PRM. Notice the compactness of the code.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00162.html#gad7e9a66c680fd8ba7395fe5b048da84a">init</a> (<span class="keyword">const</span> PlannerWkPtr_t&amp; weak)</div>
</div><!-- fragment --><p> Method <code>init</code> takes as input a weak pointer to a new instance and stores this weak pointer as a private member. This is enables any object to create a shared pointer to itself on demand using the following line of code </p>
<div class="fragment"><div class="line">weakPtr_.lock ();</div>
</div><!-- fragment --><p> which is the shared pointer equivalent to <code>this</code> when using simple pointers. </p>
<dl class="section note"><dt>Note</dt><dd>Method <code>init</code> always calls the parent implementation so that the parent part of the object also stores a weak pointer to itself.</dd></dl>
<h1><a class="anchor" id="hpp_tutorial_tutorial_2_hpp_tutorial_server"></a>
Implementation of executable hpp-tutorial-server</h1>
<p>Now that the new class <code>hpp::tutorial::Planner</code> has been implemented, we are going to use it in a new executable. The new executable is defined by </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[])</div>
</div><!-- fragment --><p> This executable creates an instance of <a class="elRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00067.html">hpp::core::ProblemSolver</a>, </p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00067.html">hpp::core::ProblemSolverPtr_t</a> problemSolver =</div>
<div class="line">  <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00067.html#a42bb1c99581e2a51e2d46d1c958ef71c">hpp::core::ProblemSolver::create</a> ();</div>
</div><!-- fragment --><p> adds the constructor of class hpp::tutorial::Planner in the map of the ProblemSolver instance with key "PRM", </p>
<div class="fragment"><div class="line">problemSolver-&gt;<a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00067.html#aaee70a5a958cb7d1b23964834812a111">addPathPlannerType</a> (<span class="stringliteral">&quot;PRM&quot;</span>, <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00164.html#ga3395c68307cad504abcf8cac8ea725fa">hpp::tutorial::Planner::create</a>);</div>
</div><!-- fragment --><p> creates a CORBA server with the ProblemSolver instance, </p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-corbaserver/doxygen-html/hpp-corbaserver.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-corbaserver/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-corbaserver/doxygen-html/a00014.html">hpp::corbaServer::Server</a> server (problemSolver, argc, argv, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p> starts the CORBA server, and </p>
<div class="fragment"><div class="line">server.startCorbaServer ();</div>
</div><!-- fragment --><p> process client requests forever. </p>
<div class="fragment"><div class="line">server.processRequest (<span class="keyword">true</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="hpp_tutorial_tutorial_2_CMakeLists"></a>
Compilation and installation</h1>
<p>The compilation and installation is done in file <code>CMakeLists.txt</code> by the following lines </p>
<div class="fragment"><div class="line">CMAKE_MINIMUM_REQUIRED (VERSION 2.6)</div>
<div class="line">INCLUDE(cmake/base.cmake)</div>
<div class="line"></div>
<div class="line">SET(PROJECT_NAME hpp_tutorial)</div>
<div class="line">SET(PROJECT_DESCRIPTION</div>
<div class="line">  &quot;Tutorial for humanoid path planner platform.&quot;</div>
<div class="line">)</div>
<div class="line">SET(PROJECT_URL &quot;&quot;)</div>
<div class="line"></div>
<div class="line">SETUP_PROJECT()</div>
<div class="line">ADD_REQUIRED_DEPENDENCY(&quot;hpp-corbaserver &gt;= 3&quot;)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Create and install executable running the corba server</span></div>
<div class="line"><span class="preprocessor"></span>ADD_EXECUTABLE (hpp-tutorial-server</div>
<div class="line">  src/tutorial.cc</div>
<div class="line">)</div>
<div class="line"><span class="preprocessor"># Link executable with hpp-corbaserver library</span></div>
<div class="line"><span class="preprocessor"></span>PKG_CONFIG_USE_DEPENDENCY (hpp-tutorial-server hpp-corbaserver)</div>
<div class="line"><span class="preprocessor"># Install executable</span></div>
<div class="line"><span class="preprocessor"></span>INSTALL (TARGETS hpp-tutorial-server DESTINATION ${CMAKE_INSTALL_BINDIR})</div>
<div class="line">SETUP_PROJECT_FINALIZE()</div>
</div><!-- fragment --><h1><a class="anchor" id="hpp_tutorial_tutorial_2_running"></a>
Running the server and solving a problem.</h1>
<p>To run your executable and solve a problem with your path planning algorithm, you simply need to follow the same steps as in tutorial 1, except that you should start </p>
<div class="fragment"><div class="line">hpp-tutorial-server</div>
</div><!-- fragment --><p> instead of <code>hppcorbaserver</code> and source <code>script/tutorial_2.py</code> instead of <code>script/tutorial_1.py</code>, or make sure that you add the following line before solving the problem </p>
<div class="fragment"><div class="line">ps.selectPathPlanner (<span class="stringliteral">&quot;PRM&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="hpp_tutorial_tutorial_2_external_package"></a>
Moving the code into an external package</h1>
<p>To implement the above executable in an external package, you should do the following steps. </p>
<ul>
<li>create a new directory in <code>src</code>, for instance <div class="fragment"><div class="line">mkdir my-hpp-project</div>
</div><!-- fragment --> </li>
<li>create a file <code>README.md</code> describing the new package <div class="fragment"><div class="line">echo <span class="stringliteral">&quot;Implementation of a new path planning algorithm embedded in a CORBA server&quot;</span> &gt; my-hpp-project/README.md</div>
</div><!-- fragment --> </li>
<li>create an empty <code>Doxyfile.extra.in</code> file <div class="fragment"><div class="line">mkdir my-hpp-project/doc; touch my-hpp-project/doc/Doxyfile.extra.in</div>
</div><!-- fragment --> </li>
<li>copy the above <code>cmake</code> code into <code>my-hpp-project/CMakeLists.txt</code>, after replacing names by the names you have chosen, </li>
<li>copy file <code>src/tutorial.cc</code> into <code>my-hpp-project/src</code> <div class="fragment"><div class="line">mkdir my-hpp-project/src</div>
<div class="line">cp hpp_tutorial/src/tutorial.cc my-hpp-project/src/.</div>
</div><!-- fragment --> Go into the project directory and initialize git. <div class="fragment"><div class="line">cd my-hpp-project; git <a class="codeRef" doxygen="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/hpp-core.doxytag:https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/" href="https://jmirabel.github.io/hpp-doc/api/hpp-core/doxygen-html/a00162.html#gad7e9a66c680fd8ba7395fe5b048da84a">init</a>; git add .</div>
</div><!-- fragment --> Import the cmake git sub-module <div class="fragment"><div class="line">git submodule add git:<span class="comment">//github.com/jrl-umi3218/jrl-cmakemodules.git cmake</span></div>
</div><!-- fragment --> Commit this first version. <div class="fragment"><div class="line">git commit -m <span class="stringliteral">&quot;My first hpp project&quot;</span></div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="hpp_tutorial_tutorial_2_external_package_installation"></a>
Installation</h2>
<p>The package is ready for installation. Create a build directory </p>
<div class="fragment"><div class="line">mkdir build; cd build</div>
</div><!-- fragment --><p> configure and install </p>
<div class="fragment"><div class="line">cmake -DCMAKE_INSTALL_PREFIX=${DEVEL_DIR}/install ..</div>
<div class="line">make install</div>
</div><!-- fragment --><p>Executable <code>hpp-tutorial-server</code> is installed and can be run from the terminal. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Apr 3 2016 14:51:29 for hpp_tutorial by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
